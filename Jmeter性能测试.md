# Jmeter性能测试

Jmeter是一款多线程性能测试工具

## 环境

需要java8+运行环境

**window：**设置环境变量JMETER_HOME为jmter解压路径；CLASSPATH追加

```
%JMETER_HOME%\lib\ext\ApacheJMeter_core.jar;
%JMETER_HOME%\lib\jorphan.jar;
%JMETER_HOME%\lib\logkit-2.0.jar;
```



## 基础名词

- **线程组：**Jmeter中一组线程的配置
  - **线程数：**线程的数量，模拟用户数量
  - **Ramp-UP：**线程需完成准备的时间
  - **循环次数：**线程循环的次数，次数完成结束执行

- **并发：**用于描述系统面临压力的客观数值
  - **并发请求：**每秒服务端收到的请求数量
  - **特殊场景：**如 websocker 长连接，同一时间服务端建立的连接数量

- **性能测试：**压测场景设计中，除了设计并发量，还要设计压测时间（30m起步）
- **调度器：**设置压测持续时间

## Jmeter使用

### 注意

测试实际数据和理论测试数据会与本地主机性能有关；

实际压测：如果并发要求高，本地主机性能不足，需要使用jmter集群压测

------

### 线程数量

- 线程在一秒中会执行多次请求

- **单线程：**单个线程循环多次执行测试，当个任务结束才会进入下一次循环

### 循环次数

- 若设置了循环次数，线程执行完次数就会停止，可能不会达到预期压测时长

- 设置循环次数为永远，再设置压测持续时间，就可以实现持续压测

### 常数吞吐量定时器

一分钟内执行任务的频率

- **吞吐量：**每分钟执行线程多少次; 60就是60/60每秒执行一次，120就是120/60每秒执行两次，30就是30/60就是每两秒执行1次

### 汇总报告

查看压测数据，请求数量

### Jmeter集群架构

集群架构的两中角色：

- 控制机：控制执行机的机器
- Jmeter-server 执行机：运行压测的机器（多台）

#### 实操

1. 多个独立环境可以通过虚拟机替代

   ```
   例如:
   192.168.1.1		运行jmeter ui界面，作为控制机
   192.168.1.100		运行jmeter-server 作为执行机
   192.168.1.101		运行jmeter-server 作为执行机
   ```

2. 启动执行机

   ```
   Linux:
   ./bin/jmeter-server -Djava.rmi.server.hostname=192.168.1.101	启动服务并指定此执行机的ip地址
   ```

3. 控制机 jmeter 配置远程 jmeter-server 地址

   ```
   jmeter的bin目录中 jmeter.properties 文件，指定执行机器的IP端口，并重启jmeter
   
   remote_hosts=192.168.1.100:1009,192.168.1.101:1009
   ```

   



------

### 执行方案实操设置

**需求1：**20/s并发压测，持续30s

1. 设置线程数为20
2. 循环次数为永远
3. 设置持续时长为30s
4. 添加常数吞吐量定时器，设置目标吞吐量60；则一分钟内每秒执行一次线程数为20的压测，持续30s

## 测试步骤

1. 测试分析
2. 测试执行
3. 测试性能瓶颈报告